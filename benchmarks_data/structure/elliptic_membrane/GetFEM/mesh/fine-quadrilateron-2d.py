import getfem as gf
import numpy as np
import pyvista as pv

pv.set_plot_theme("document")

mesh = gf.Mesh("empty", 2)
# gt = gf.GeoTrans("GT_PRODUCT(GT_PK(1,2), GT_PK(1,2))")
# gt = gf.GeoTrans("GT_QK(2,2)")
gt = gf.GeoTrans("GT_Q2_INCOMPLETE(2)")
x = [0, 1, 2, 0, 2, 0, 1, 2, 0, 2, 0, 1, 2]
y = [0, 0, 0, 1, 1, 2, 2, 2, 3, 3, 4, 4, 4]
mesh.add_convex(gt, [[x[0], x[1], x[2], x[3], x[4], x[5], x[6], x[7]], [y[0], y[1], y[2], y[3], y[4], y[5], y[6], y[7]]])
mesh.add_convex(gt, [[x[5], x[6], x[7], x[8], x[9], x[10], x[11], x[12]], [y[5], y[6], y[7], y[8], y[9], y[10], y[11], y[12]]])
#x = [
#   2.12968779,
#   1.78302097,
#           2.,
#   2.41700006,
#   1.16499996,
#   1.36939037,
#           0.,
#           0.,
#   2.83276558,
#         3.25,
#   1.78299999,
#           0.,
#   1.95635438,
#   1.93760836,
#   2.20849991,
#   2.33895946,
#   1.26719522,
#  0.699454725,
#           0.,
#  0.590530932,
#   2.48122668,
#   2.83349991,
#   3.14145494,
#   1.57619524,
#   1.78156114,
#   2.36494803,
#  0.920210361,
#           0.,
#   1.49321365,
#   2.13828373,
#  0.644992828,
#    2.7402072,
#   2.07325459,
#  0.809832573,
#   1.63738739,
#   2.04302096,
#   2.04731894,
#   2.23862171,
#   2.25020337,
#   1.86968768,
#   1.87159467,
#   2.03794599,
#   2.17339182,
#   2.31274986,
#   2.39741039,
#   1.98434079,
#   2.10424995,
#   1.21609759,
#  0.956094027,
#   0.61776185,
#  0.889270782,
#   1.31829286,
#   1.04687166,
#  0.672223806,
#  0.322496414,
#           0.,
#  0.298612624,
#  0.353529572,
#           0.,
#   2.65699625,
#   2.61071682,
#   2.94083118,
#   3.01119447,
#   2.30545712,
#   2.53958321,
#   2.78685355,
#   3.04174995,
#   3.22274947,
#   2.62524986,
#   1.67959762,
#   1.82472491,
#   2.21910143,
#   2.08827782,
#   1.47279274,
#   1.58562696,
#   1.92740786,
#   2.27724075,
#   2.61824918,
#   1.97093856,
#   1.19301391,
#  0.754643679,
#   1.36630476,
#  0.865021467,
#  0.404916286,
#           0.,
#  0.464885771,
#           0.,
#   1.45229125,
#   1.70947433,
#   1.33727348,
#   1.56530046,
#   1.79687095,
#   1.65181267,
#]
#y = [
#  0.748563945,
#  0.453000009,
#           0.,
#           0.,
#  0.812830687,
#   1.30441773,
#   1.58299994,
#           1.,
#   1.34800005,
#           0.,
#   2.29920578,
#         2.75,
#  0.600781977,
#   0.24782756,
#           0.,
#  0.399010003,
#   1.05862427,
#   1.51526558,
#   1.29149997,
#  0.955415249,
#   1.04828203,
#           0.,
#  0.704780996,
#   1.80181181,
#   1.06977248,
#   1.88628185,
#   2.63746476,
#   2.16650009,
#   0.66526556,
#  0.323418766,
#   1.23534048,
#  0.551895499,
#   1.47802711,
#   2.07636523,
#  0.867518961,
#  0.674672961,
#  0.462100387,
#  0.361214399,
#  0.577865005,
#  0.526890993,
#  0.352538496,
#  0.285623163,
#  0.161709383,
#           0.,
#  0.201135173,
#  0.124891631,
#           0.,
#  0.935727477,
#   1.14698243,
#   1.09537792,
#   0.89571166,
#   1.18152106,
#   1.42680883,
#   1.37530303,
#   1.26342022,
#   1.14575005,
#  0.988790989,
#   1.56597483,
#   1.43725002,
#   1.19814098,
#  0.800088763,
#  0.628338218,
#   1.03466594,
#  0.898422956,
#  0.475452751,
#   0.27594775,
#           0.,
#  0.355370194,
#           0.,
#   2.05050874,
#   1.63991952,
#   1.68215442,
#   2.10717726,
#   1.55311477,
#   1.19474387,
#   1.27389979,
#   1.26315451,
#   1.62920785,
#   0.91628772,
#   1.93908858,
#   1.79581547,
#   2.49518013,
#     2.356915,
#   2.12143278,
#   1.87475002,
#    2.7217207,
#   2.45825005,
#  0.963071585,
#  0.968645692,
#  0.743589222,
#  0.766392231,
#  0.734150469,
#  0.563807368,
#]
#mesh.add_convex(gt, [[x[  0], x[ 12], x[ 29], x[ 15], x[ 35], x[ 36], x[ 37], x[ 38]], [y[  0], y[ 12], y[ 29], y[ 15], y[ 35], y[ 36], y[ 37], y[ 38]]])
#mesh.add_convex(gt, [[x[ 12], x[  1], x[ 13], x[ 29], x[ 39], x[ 40], x[ 41], x[ 36]], [y[ 12], y[  1], y[ 13], y[ 29], y[ 39], y[ 40], y[ 41], y[ 36]]])
#mesh.add_convex(gt, [[x[ 15], x[ 29], x[ 14], x[  3], x[ 37], x[ 42], x[ 43], x[ 44]], [y[ 15], y[ 29], y[ 14], y[  3], y[ 37], y[ 42], y[ 43], y[ 44]]])
#mesh.add_convex(gt, [[x[ 29], x[ 13], x[  2], x[ 14], x[ 41], x[ 45], x[ 46], x[ 42]], [y[ 29], y[ 13], y[  2], y[ 14], y[ 41], y[ 45], y[ 46], y[ 42]]])
#mesh.add_convex(gt, [[x[  4], x[ 16], x[ 30], x[ 19], x[ 47], x[ 48], x[ 49], x[ 50]], [y[  4], y[ 16], y[ 30], y[ 19], y[ 47], y[ 48], y[ 49], y[ 50]]])
#mesh.add_convex(gt, [[x[ 16], x[  5], x[ 17], x[ 30], x[ 51], x[ 52], x[ 53], x[ 48]], [y[ 16], y[  5], y[ 17], y[ 30], y[ 51], y[ 52], y[ 53], y[ 48]]])
#mesh.add_convex(gt, [[x[ 19], x[ 30], x[ 18], x[  7], x[ 49], x[ 54], x[ 55], x[ 56]], [y[ 19], y[ 30], y[ 18], y[  7], y[ 49], y[ 54], y[ 55], y[ 56]]])
#mesh.add_convex(gt, [[x[ 30], x[ 17], x[  6], x[ 18], x[ 53], x[ 57], x[ 58], x[ 54]], [y[ 30], y[ 17], y[  6], y[ 18], y[ 53], y[ 57], y[ 58], y[ 54]]])
#mesh.add_convex(gt, [[x[  8], x[ 20], x[ 31], x[ 22], x[ 59], x[ 60], x[ 61], x[ 62]], [y[  8], y[ 20], y[ 31], y[ 22], y[ 59], y[ 60], y[ 61], y[ 62]]])
#mesh.add_convex(gt, [[x[ 20], x[  0], x[ 15], x[ 31], x[ 63], x[ 38], x[ 64], x[ 60]], [y[ 20], y[  0], y[ 15], y[ 31], y[ 63], y[ 38], y[ 64], y[ 60]]])
#mesh.add_convex(gt, [[x[ 22], x[ 31], x[ 21], x[  9], x[ 61], x[ 65], x[ 66], x[ 67]], [y[ 22], y[ 31], y[ 21], y[  9], y[ 61], y[ 65], y[ 66], y[ 67]]])
#mesh.add_convex(gt, [[x[ 31], x[ 15], x[  3], x[ 21], x[ 64], x[ 44], x[ 68], x[ 65]], [y[ 31], y[ 15], y[  3], y[ 21], y[ 64], y[ 44], y[ 68], y[ 65]]])
#mesh.add_convex(gt, [[x[ 10], x[ 23], x[ 32], x[ 25], x[ 69], x[ 70], x[ 71], x[ 72]], [y[ 10], y[ 23], y[ 32], y[ 25], y[ 69], y[ 70], y[ 71], y[ 72]]])
#mesh.add_convex(gt, [[x[ 23], x[  5], x[ 24], x[ 32], x[ 73], x[ 74], x[ 75], x[ 70]], [y[ 23], y[  5], y[ 24], y[ 32], y[ 73], y[ 74], y[ 75], y[ 70]]])
#mesh.add_convex(gt, [[x[ 25], x[ 32], x[ 20], x[  8], x[ 71], x[ 76], x[ 59], x[ 77]], [y[ 25], y[ 32], y[ 20], y[  8], y[ 71], y[ 76], y[ 59], y[ 77]]])
#mesh.add_convex(gt, [[x[ 32], x[ 24], x[  0], x[ 20], x[ 75], x[ 78], x[ 63], x[ 76]], [y[ 32], y[ 24], y[  0], y[ 20], y[ 75], y[ 78], y[ 63], y[ 76]]])
#mesh.add_convex(gt, [[x[  5], x[ 23], x[ 33], x[ 17], x[ 73], x[ 79], x[ 80], x[ 52]], [y[  5], y[ 23], y[ 33], y[ 17], y[ 73], y[ 79], y[ 80], y[ 52]]])
#mesh.add_convex(gt, [[x[ 23], x[ 10], x[ 26], x[ 33], x[ 69], x[ 81], x[ 82], x[ 79]], [y[ 23], y[ 10], y[ 26], y[ 33], y[ 69], y[ 81], y[ 82], y[ 79]]])
#mesh.add_convex(gt, [[x[ 17], x[ 33], x[ 27], x[  6], x[ 80], x[ 83], x[ 84], x[ 57]], [y[ 17], y[ 33], y[ 27], y[  6], y[ 80], y[ 83], y[ 84], y[ 57]]])
#mesh.add_convex(gt, [[x[ 33], x[ 26], x[ 11], x[ 27], x[ 82], x[ 85], x[ 86], x[ 83]], [y[ 33], y[ 26], y[ 11], y[ 27], y[ 82], y[ 85], y[ 86], y[ 83]]])
#mesh.add_convex(gt, [[x[  5], x[ 16], x[ 34], x[ 24], x[ 51], x[ 87], x[ 88], x[ 74]], [y[  5], y[ 16], y[ 34], y[ 24], y[ 51], y[ 87], y[ 88], y[ 74]]])
#mesh.add_convex(gt, [[x[ 16], x[  4], x[ 28], x[ 34], x[ 47], x[ 89], x[ 90], x[ 87]], [y[ 16], y[  4], y[ 28], y[ 34], y[ 47], y[ 89], y[ 90], y[ 87]]])
#mesh.add_convex(gt, [[x[ 24], x[ 34], x[ 12], x[  0], x[ 88], x[ 91], x[ 35], x[ 78]], [y[ 24], y[ 34], y[ 12], y[  0], y[ 88], y[ 91], y[ 35], y[ 78]]])
#mesh.add_convex(gt, [[x[ 34], x[ 28], x[  1], x[ 12], x[ 90], x[ 92], x[ 39], x[ 91]], [y[ 34], y[ 28], y[  1], y[ 12], y[ 90], y[ 92], y[ 39], y[ 91]]])
mesh.save("fine-quadrilateron-2d.msh")
mesh.export_to_vtk("fine-quadrilateron-2d.vtk", "ascii")

m = pv.read("fine-quadrilateron-2d.vtk")
m.plot(cpos="xy", show_edges=True, screenshot="fine-quadrilateron-2d.png")
m.separate_cells().extract_feature_edges().plot(cpos="xy", show_edges=True, screenshot="fine-quadrilateron-2d.png", line_width=3, color="black")
